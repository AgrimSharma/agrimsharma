<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <title>Django | Chapter 4: Message Board app</title>
  <meta name="description" content="Learn how to develop and deploy real, production-level web applications with Python and Django. And explore Django Rest Framework for building modern web APIs.">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/main.css">
  <link rel="canonical" href="https://djangoforbeginners.com/">
</head>
<body class="site">
  <header class="header-home">
    <div class="container-flex">
        <h1 class="h1-home">Django 2.0 Tutorial for Beginners</h1>

    </div>
  </header>
  <main class="site-content">
    <div class="container-flex">
      <article class="post">

  <div class="post-header">
    <h1 class="post-title" itemprop="name headline">Chapter 4: Message Board app</h1>
    <p class="post-meta">
      Create your first database-driven app and use the Django admin</p>
  </div>

  <div class="post-content" itemprop="articleBody">
    <p>In this chapter we will use a database for the first time to build a basic <em>message board</em> application. We’ll explore Django’s powerful built-in admin interface which provides a visual way to make changes to our data. And after adding tests we will push our code to Bitbucket and deploy the app on Heroku.</p>

<p>Complete source code can be <a href="https://github.com/wsvincent/djangoforbeginners/tree/master/ch4-message-board-app" target="\_blank">found on Github</a>.</p>

<h2 id="databases">Databases</h2>
<p>Django provides built-in support for several types of databases. But the simplest–<strong>by far</strong>–to use is <a href="https://www.sqlite.org/">SQLite</a> because it runs off a single file and requires no complex installation. Django uses SQLite by default for this reason and it’s a perfect choice for small projects. Later on in this book we’ll explore how to use a production-level database like <a href="https://www.postgresql.org/">PostgreSQL</a>.</p>

<h2 id="setup">Setup</h2>
<p>Since we’ve already set up several Django projects at this point in the book, we can quickly run through our commands to begin a new one. We need to do the following:</p>

<ul>
  <li>create a new directory for our code on the Desktop called <code class="highlighter-rouge">mb</code></li>
  <li>install Django in a new virtual environment</li>
  <li>create a new project called <code class="highlighter-rouge">mb_project</code></li>
  <li>create a new app call <code class="highlighter-rouge">posts</code></li>
  <li>update <code class="highlighter-rouge">settings.py</code></li>
</ul>

<p>In a new command line console, enter the following commands. Note that I’m using <code class="highlighter-rouge">(mb)</code> here to represent the virtual environment name even though it’s actually <code class="highlighter-rouge">(mb-XXX)</code> where <code class="highlighter-rouge">XXX</code> represents random characters.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd ~/Desktop
$ mkdir mb
$ cd mb
$ pipenv install django
$ pipenv shell
(mb) $ django-admin.py startproject mb_project .
(mb) $ ./manage.py startapp posts
</code></pre>
</div>

<p>Tell Django about the new app <code class="highlighter-rouge">posts</code> by adding it to the bottom of the <code class="highlighter-rouge">INSTALLED_APPS</code> section of our <code class="highlighter-rouge">settings.py</code> file.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># mb_project/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'posts'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre>
</div>

<p>And execute <code class="highlighter-rouge">migrate</code> to create an initial database based on Django’s default settings.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py migrate
</code></pre>
</div>

<p>If you look inside our directory with the <code class="highlighter-rouge">ls</code> command, you’ll see there’s now a file <code class="highlighter-rouge">db.sqlite3</code> representing our <a href="https://www.sqlite.org/">SQLite</a> database.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ls
db.sqlite3 mb_project manage.py
</code></pre>
</div>

<p>To confirm everything works correctly, spin up our local server.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py runserver
</code></pre>
</div>

<p>And navigate to <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> to see the familiar Django installed correctly page.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/02_django_welcome.png" alt="Django welcome page" /></p>

<h2 id="create-a-database-model">Create a database model</h2>
<p>Our first task is to create a database model where we can store and display posts from our users. Django will turn this model into a database table for us. In real-world Django projects, it’s often the case that there will be many complex, interconnected database models but in our simple message board app we only need one.</p>

<p>I won’t cover database design in this book but I have written a short guide which <a href="https://wsvincent.com/database-design-tutorial-for-beginners/" target="\_blank">you can find here</a> if this is all new to you.</p>

<p>Open the <code class="highlighter-rouge">posts/models.py</code> file and look at default code which Django provides:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c"># Create your models here</span>
</code></pre>
</div>

<p>Django imports a module <code class="highlighter-rouge">models</code> to help us build new database models, which will “model” the characteristics of the data in our database. We want to create a model to store the textual content of a message board post, which we can do so as follows:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</code></pre>
</div>

<p>Note that we’ve created a new database model called <code class="highlighter-rouge">Post</code> which has the database field <code class="highlighter-rouge">text</code>. We’ve also specified the <em>type of content</em> it will hold, <code class="highlighter-rouge">TextField()</code>. Django provides many <a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/">model fields</a> supporting common types of content such as characters, dates, integers, emails, and so on.</p>

<h2 id="activating-models">Activating models</h2>
<p>Now that our new model is created we need to activate it. Going forward, whenever we create or modify an existing model we’ll need to update Django in a two-step process.</p>

<ol>
  <li>
    <p>First we create a migration file with the <code class="highlighter-rouge">makemigrations</code> command. Migrations can be thought of as a list of instructions for how to build the database. When we make future changes to our database structure, each will have its own migrations files. This way we have a record of all our changes rather than destroying and recreating our database from scratch each time.</p>
  </li>
  <li>
    <p>Second we build the actual database with the <code class="highlighter-rouge">migrate</code> command based on the migrations file.</p>
  </li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py makemigrations posts
(mb) $ ./manage.py migrate posts
</code></pre>
</div>

<p>Note that you don’t <em>have</em> to include a name after either <code class="highlighter-rouge">makemigrations</code> or <code class="highlighter-rouge">migrate</code>. If you simply run the commands then they will apply to all available changes. But it’s a good habit to be specific. That way if you need to look at past migrations, there is only one change per migration rather than one that applies to multiple apps.</p>

<h2 id="django-admin">Django Admin</h2>
<p>Django provides us with a robust admin interface for interacting with our database. This is a truly killer feature that few web frameworks offer. It has its routes in <a href="https://docs.djangoproject.com/en/2.0/faq/general/">Django’s origin as a project at a newspaper</a>. The developers wanted a CMS (Content Management System) so that writers could write their stories without needing to touch “code.” Over time it has evolved into a fantastic, out-of-the-box tool for managing all aspects of a Django project.</p>

<p>To use the Django admin, we first need to create a <code class="highlighter-rouge">superuser</code> who can login. In your command line console, type <code class="highlighter-rouge">./manage.py createsuperuser</code> and respond to the prompts for a username, email, and password:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py createsuperuser
Username (leave blank to use 'wsv'): wsv
Email:
Password:
Password (again):
Superuser created successfully.
</code></pre>
</div>

<p><strong>Note</strong>: When you type your password, it will not appear visible in the command line console for security reasons.</p>

<p>Restart the Django server with <code class="highlighter-rouge">./manage.py runserver</code> and in your browser go to <a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a>. You should see the admin’s login screen:</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_login.png" alt="Admin login page" /></p>

<p>Login by entering the username and password you just created. You will see the Django admin homepage next:</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_home.png" alt="Admin homepage" /></p>

<p>But where’s our <code class="highlighter-rouge">posts</code> app? It’s not displayed on the main admin page!</p>

<p>We need to explicitly tell Django what to display in the admin. Fortunately we can change fix this easily by opening the <code class="highlighter-rouge">posts/admin.py</code> file and editing it to look like this:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/admin.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
</code></pre>
</div>

<p>Django now knows that it should display our <code class="highlighter-rouge">posts</code> app and its database model <code class="highlighter-rouge">Post</code> on the admin page. If you refresh your browser you’ll see that it now appears:</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_app.png" alt="Admin homepage updated" /></p>

<p>Now let’s create our first message board post for our database. Click on the <code class="highlighter-rouge">+ Add</code> button opposite <code class="highlighter-rouge">Posts</code>. Enter your own text in the <code class="highlighter-rouge">Text</code> form field.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_first_entry.png" alt="Admin new entry" /></p>

<p>Then click the “Save” button, which will redirect you to the main Post page. However if you look closely, there’s a problem: our new entry is called “Post object”, which isn’t very helpful.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_post_object.png" alt="Admin new entry" /></p>

<p>Let’s change that. Within the <code class="highlighter-rouge">posts/models.py</code> file, add a new function <code class="highlighter-rouge">__str__</code> as follows:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""A string representation of the model."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
</code></pre>
</div>

<p>If you refresh your Admin page in the browser, you’ll see it’s changed to a much more descriptive and helpful representation of our database entry.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_post_str.png" alt="Admin new entry" /></p>

<p>Much better! It’s important to add <code class="highlighter-rouge">str()</code> methods to all of your models to improve their readability.</p>

<h2 id="viewstemplatesurls">Views/Templates/URLs</h2>
<p>In order to display our database content on our homepage, we have to wire up our views, templates, and URLConfs. This should start to feel familiar now.</p>

<p>Let’s start with the view. Earlier in the book we used the built-in generic <a href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/base/#django.views.generic.base.TemplateView">TemplateView</a> to display a template file on our homepage. Now we want to list the contents of our database model. Fortunately this is a common task and can be done with the generic class-based view  <a href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#listview">ListView</a>.</p>

<p>In the <code class="highlighter-rouge">posts/views.py</code> file enter the Python code below:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/views.py</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">HomePageView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'home.html'</span>
</code></pre>
</div>

<p>In the first line we’re importing <code class="highlighter-rouge">ListView</code> and in the second line we need to explicitly define which model we’re using. In the view, we subclass <code class="highlighter-rouge">ListView</code>, specify our model name and specify our template reference. Internally <code class="highlighter-rouge">ListView</code> returns an object called <code class="highlighter-rouge">object_list</code> that we want to display in our template.</p>

<p>Our view is complete which means we still need to configure our URLs and make our template. Let’s start with the template. Create a project-level directory called <code class="highlighter-rouge">templates</code> and a <code class="highlighter-rouge">home.html</code> template file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ mkdir templates
(mb) $ touch templates/home.html
</code></pre>
</div>

<p>Then update the <code class="highlighter-rouge">DIRS</code> field in our <code class="highlighter-rouge">settings.py</code> file so that Django knows to look in this templates folder.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># settings.py</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">)],</span>
        <span class="o">...</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre>
</div>

<p>In our templates file <code class="highlighter-rouge">home.html</code> we can use the <a href="https://docs.djangoproject.com/en/2.0/ref/templates/language/">Django Templating Language’s</a> <code class="highlighter-rouge">for</code> loop to list all the objects in <code class="highlighter-rouge">object_list</code>. Remember that <code class="highlighter-rouge">object_list</code> is what <code class="highlighter-rouge">ListView</code> returns to us.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/home.html --&gt;</span>
<span class="nt">&lt;h1&gt;</span>Message board homepage<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
  {% for post in object_list %}
    <span class="nt">&lt;li&gt;</span>{{ post }}<span class="nt">&lt;/li&gt;</span>
  {% endfor %}
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
</div>

<p>The last step is to set up our URLConfs. Let’s start with the project-level <code class="highlighter-rouge">urls.py</code> file where we simply include our <code class="highlighter-rouge">posts</code> and add <code class="highlighter-rouge">include</code> on the second line.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># mb_project/urls.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'posts.urls'</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>Then create an app-level <code class="highlighter-rouge">urls.py</code> file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ touch posts/urls.py
</code></pre>
</div>

<p>And update it like so:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/urls.py</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">HomePageView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>Restart the server with <code class="highlighter-rouge">./manage.py runserver</code> and navigate to our homepage <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> which now lists out our message board posts.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_homepage_helloworld.png" alt="Homepage with posts" /></p>

<p>We’re basically done at this point, but let’s create a few more message board posts in the Django admin to confirm that they’ll all display correctly on the homepage.</p>

<h2 id="adding-new-posts">Adding new posts</h2>
<p>To add new posts to our message board, go back into the Admin at <a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> and add two more posts. Here’s what mine look like:</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_second_entry.png" alt="Admin entry" /></p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_third_entry.png" alt="Admin entry" /></p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_admin_three_entries.png" alt="Updated admin entries section" /></p>

<p>If you return to the homepage you’ll see it automatically displays our formatted posts. Woohoo!</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_django_homepage_three_entries.png" alt="Homepage with three entries" /></p>

<p>Everything works so let’s first initialize our directory, add the new code, and include our first <code class="highlighter-rouge">git</code> commit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ git init
(mb) $ git add -A
(mb) $ git commit -m 'initial commit'
</code></pre>
</div>

<h2 id="tests">Tests</h2>
<p>Time for our tests. The best time to right tests is either before you’ve written any actual code (Test Driven Development) or right after when the new features are fresh in your mind. Write some tests, check that they work, and then feel confident that if you inadvertently break something down the road–and you will–the tests will catch it for you.</p>

<p>Previously we were only testing static pages so we used <a href="https://docs.djangoproject.com/en/2.0/topics/testing/tools/#django.test.SimpleTestCase">SimpleTestCase</a>. But now that our homepage works with a database, we need to use <a href="https://docs.djangoproject.com/en/2.0/topics/testing/tools/#django.test.TestCase">TestCase</a> which will let us create a “test” database we can check against. In other words, we don’t need to run tests on our <em>actual</em> database but instead can make a separate test database, fill it with sample data, and then test against it.</p>

<p>Let’s start by adding a sample post to the <code class="highlighter-rouge">text</code> database field and then check that it is stored correctly in the database. It’s important that all our test methods start with <code class="highlighter-rouge">test_</code> so Django knows to test them! The code will look like this:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># posts/tests.py</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">PostModelTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpTestData</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c"># Set up data for our Test Case</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">'just a test'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_text_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expected_object_name</span> <span class="o">=</span> <span class="n">f</span><span class="s">'{post.text}'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_object_name</span><span class="p">,</span> <span class="s">'just a test'</span><span class="p">)</span>
</code></pre>
</div>

<p>At the top we import the <code class="highlighter-rouge">TestCase</code> module which lets us create a sample database, then import our <code class="highlighter-rouge">Post</code> model. We create a new class <code class="highlighter-rouge">PostModelTest</code> and add a method <code class="highlighter-rouge">setUpTestData</code> to create a new database that has just one entry: a post with a text field containing the string ‘just a test’.</p>

<p>Then we run our first test <code class="highlighter-rouge">test_text_content</code> to check that the database field actually contains <code class="highlighter-rouge">just a test</code>! We create a variable called <code class="highlighter-rouge">post</code> that represents the first <code class="highlighter-rouge">id</code> on our Post model. Remember that Django automatically sets this id for us. If we created another entry it would have an id of 2, the next one would be 3, and so on.</p>

<p>The following line uses <a href="https://www.python.org/dev/peps/pep-0498/">f strings</a> which are a very cool addition to Python 3.6. They let us put variables directly in our strings as long as the variables are surrounded by brackets <code class="highlighter-rouge"><span class="p">{}</span></code>. Here we’re setting <code class="highlighter-rouge">expected_object_name</code> to be the string of the value in <code class="highlighter-rouge">post.text</code>, which should be <code class="highlighter-rouge">just a test</code>.</p>

<p>On the final line we use <code class="highlighter-rouge">assertEqual</code> to check that our newly created entry does in fact match what we input at the top. Go ahead and run the test on the command line with <code class="highlighter-rouge">./manage.py test</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py test
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
Destroying test database for alias 'default'...
</code></pre>
</div>

<p>It passed!</p>

<p>Don’t worry if the previous explanation felt like information overload. That’s natural the first time you start writing tests, but you’ll soon find that most tests that you write are actually quite repetitive.</p>

<p>Time for our second test. The first test was on the model but now we want test our one and only page: the homepage. Specifically, we want to test that it exists (throws an HTTP 200 response), uses the <code class="highlighter-rouge">home</code> view, and uses the <code class="highlighter-rouge">home.html</code> template.</p>

<p>We’ll need to add one more import at the top <code class="highlighter-rouge">reverse</code> and a brand new class <code class="highlighter-rouge">HomePageViewTest</code> to do this.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostModelTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpTestData</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c"># Set up data for our Test Case</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">'just a test'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_text_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expected_object_name</span> <span class="o">=</span> <span class="n">f</span><span class="s">'{post.text}'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_object_name</span><span class="p">,</span> <span class="s">'just a test'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">HomePageViewTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpTestData</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">'this is another test'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_url_exists_at_proper_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_url_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_uses_correct_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s">'home.html'</span><span class="p">)</span>
</code></pre>
</div>

<p>If you run our tests again you should see that they pass.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ ./manage.py test
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 4 tests in 0.036s

OK
Destroying test database for alias 'default'...
</code></pre>
</div>

<p>Why does it say four tests? Remember that our <code class="highlighter-rouge">setUpTestData</code> methods are not actually tests, they merely let us run subsequent tests. Our four actual tests are <code class="highlighter-rouge">test_text_content</code>, <code class="highlighter-rouge">test_view_url_exists_at_proper_location</code>, <code class="highlighter-rouge">test_view_url_by_name</code>, and <code class="highlighter-rouge">test_view_uses_correct_template</code>.</p>

<p>Any function that has the word <code class="highlighter-rouge">test*</code> at the beginning and exists in a <code class="highlighter-rouge">tests.py</code> file will be run when we execute the command <code class="highlighter-rouge">./manage.py test</code>.</p>

<p>We’re done adding code for our testing so it’s time to commit the changes to git.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ git add -A
(mb) $ git commit -m 'added tests'
</code></pre>
</div>

<h2 id="bitbucket">Bitbucket</h2>
<p>We also need to store our code on Bitbucket. This is a good habit to get into in case anything happens to your local computer and it also allows you to share and collaborate with other developers.</p>

<p>You should already have a Bitbucket account from <a href="/simple/">Chapter 3: A simple app</a> so go ahead and <a href="https://bitbucket.org/repo/create">crate a new repo</a> which we’ll call <code class="highlighter-rouge">mb-app</code>.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_bitbucket.png" alt="Bitbucket create app" /></p>

<p>On the next page click on the bottom link for “I have an existing project”. Copy the two commands to connect and then push the repository to Bitbucket.</p>

<p>It should look like this, replacing <code class="highlighter-rouge">wsvincent</code> (my username) with your Bitbucket username:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ git remote add origin <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="44232d3004262d302631272f21306a2b3623">[email&#160;protected]</a>:wsvincent/mb-app.git
(mb) $ git push -u origin master
</code></pre>
</div>

<h2 id="heroku-configuration">Heroku configuration</h2>
<p>You should also already have a Heroku account setup and installed from <a href="/simple/">Chapter 3: A simple app</a>. We need to make the following changes to our <em>Message Board</em> project to deploy it online:</p>

<ul>
  <li>update <code class="highlighter-rouge">Pipfile.lock</code></li>
  <li>new <code class="highlighter-rouge">Procfile</code></li>
  <li>install <code class="highlighter-rouge">gunicorn</code></li>
  <li>update <code class="highlighter-rouge">settings.py</code></li>
</ul>

<p>Within your <code class="highlighter-rouge">Pipfile</code> specify the version of Python we’re using, which is <code class="highlighter-rouge">3.6</code>. Add these two lines at the bottom of the file.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Pipfile</span>
<span class="p">[</span><span class="n">requires</span><span class="p">]</span>
<span class="n">python_version</span> <span class="o">=</span> <span class="s">"3.6"</span>
</code></pre>
</div>

<p>Then run <code class="highlighter-rouge">pipenv lock</code> to generate the appropriate <code class="highlighter-rouge">Pipfile.lock</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ pipenv lock
</code></pre>
</div>

<p>Then create a <code class="highlighter-rouge">Procfile</code> which tells Heroku <em>how</em> to run the remote server where our code will live.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ touch Procfile
</code></pre>
</div>

<p>For now we’re telling Heroku to use <code class="highlighter-rouge">gunicorn</code> as our production server and look in our <code class="highlighter-rouge">mb_project.wsgi</code> file for further instructions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>web: gunicorn mb_project.wsgi --log-file -
</code></pre>
</div>

<p>Next install <a href="http://gunicorn.org/">gunicorn</a> which we’ll use in production while still using Django’s internal server for local development use.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ pipenv install gunicorn
</code></pre>
</div>

<p>Finally update <code class="highlighter-rouge">ALLOWED_HOSTS</code> in our <code class="highlighter-rouge">settings.py</code> file.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># mb_project/settings.py</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'*'</span><span class="p">]</span>
</code></pre>
</div>

<p>We’re all done! Add and commit our new changes to git and then push them up to Bitbucket.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ git status
(mb) $ git add -A
(mb) $ git commit -m 'New updates for Heroku deployment'
(mb) $ git push -u origin master
</code></pre>
</div>

<h2 id="heroku-deployment">Heroku deployment</h2>
<p>Make sure you’re logged into your correct Heroku account.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ heroku login
</code></pre>
</div>

<p>Then run the <code class="highlighter-rouge">create</code> command and Heroku will randomly generate an app name for you. You can customize this later if desired.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ heroku create
Creating app... done, ⬢ agile-inlet-25811
https://agile-inlet-25811.herokuapp.com/ | https://git.heroku.com/agile-inlet-25811.git
</code></pre>
</div>

<p>Push the code to Heroku using the name of your new app. Mine is <code class="highlighter-rouge">agile-inlet-25811</code> so the command looks like this.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ heroku git:remote -a agile-inlet-25811
</code></pre>
</div>

<p>Tell Heroku to ignore static files which we’ll cover in-depth when deploying our <em>Blog app</em> later in the book.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ heroku config:set DISABLE_COLLECTSTATIC=1
</code></pre>
</div>

<p>And push the code to Heroku and add free scaling so it’s actually running online.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(mb) $ git push heroku master
(mb) $ heroku ps:scale web=1
</code></pre>
</div>

<p>If you open the new project with <code class="highlighter-rouge">heroku open</code> it will automatically launch a new browser window with the URL of your app. Mine is live at <a href="https://agile-inlet-25811.herokuapp.com/">https://agile-inlet-25811.herokuapp.com/</a>.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/04_heroku_live.png" alt="Live site" /></p>

<h2 id="conclusion">Conclusion</h2>
<p>We’ve now built, tested, and deployed our first database-driven app. While it’s deliberately quite basic, now we know how to create a database model, update it with the admin panel, and then display the contents on a webpage. But something is missing, no?</p>

<p>In the real-world, users need forms to interact with our site. After all, not everyone should have access to the admin panel. In the next chapter we’ll build a blog application that uses forms so that users can create, edit, and delete posts. We’ll also add styling via CSS.</p>

<p>Continue on to <a href="chapter_05.html">Chapter 5: Blog app</a>.</p>
  </div>
</article>


    </div>
  </main>
    <footer>
  <div class="container-flex">
    <div class="nav-wrapper">
      <div class="footer-left">
        Copyright &copy; 2018
      </div>
      <div class="footer-right">
        <a href="/">Home</a>
        <a href="/about/">About</a>
        <a href="http://eepurl.com/cRL-aP" target="_blank">Newsletter</a>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
