<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <title>Django | Chapter 5: Blog app</title>
  <meta name="description" content="Learn how to develop and deploy real, production-level web applications with Python and Django. And explore Django Rest Framework for building modern web APIs.">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/main.css">
  <link rel="canonical" href="https://djangoforbeginners.com/">
</head>
<body class="site">
  <header class="header-home">
    <div class="container-flex">
        <h1 class="h1-home">Django 2.0 Tutorial for Beginners</h1>

    </div>
  </header>
  <main class="site-content">
    <div class="container-flex">
      <article class="post">

  <div class="post-header">
    <h1 class="post-title" itemprop="name headline">Chapter 5: Blog app</h1>
    <p class="post-meta">
      Create a blog app with styling</p>
  </div>

  <div class="post-content" itemprop="articleBody">
    <p>In this chapter we’ll build a basic blog application that displays a list of all blog posts on the homepage, has a dedicated page for each blog post, and introduces static files via CSS for styling.</p>

<p>Complete source code can be <a href="https://github.com/wsvincent/djangoforbeginners/tree/master/ch5-blog-app" target="\_blank">found on Github</a>.</p>

<h2 id="initial-setup">Initial Setup</h2>

<p>As covered in previous chapters, our steps for setting up a new Django project are as follows:</p>

<ul>
  <li>create a new directory for our code on the Desktop called <code class="highlighter-rouge">blog</code></li>
  <li>install Django in a new virtual environment</li>
  <li>create a new Django project called <code class="highlighter-rouge">blog_project</code></li>
  <li>create a new app <code class="highlighter-rouge">blog</code></li>
  <li>perform a migration to set up the database</li>
  <li>update <code class="highlighter-rouge">settings.py</code></li>
</ul>

<p>Execute the following commands in a new command line console. Note that the actual name of the virtual environment will be <code class="highlighter-rouge">(blog-XXX)</code> where <code class="highlighter-rouge">XXX</code> represents random characters. I’m using <code class="highlighter-rouge">(blog)</code> here to keep things simpler since my name will differ from yours.</p>

<p>And don’t forget to include the period <code class="highlighter-rouge">.</code> at the end of the command for creating our new <code class="highlighter-rouge">blog_project</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd ~/Desktop
$ mkdir blog
$ cd blog
$ pipenv install django
$ pipenv shell
(blog) $ django-admin.py startproject blog_project .
(blog) $ ./manage.py startapp blog
(blog) $ ./manage.py migrate
(blog) $ ./manage.py runserver
</code></pre>
</div>

<p>To ensure Django knows about our new app, add it to the <code class="highlighter-rouge">INSTALLED_APPS</code> in our <code class="highlighter-rouge">settings.py</code> file:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog_project/settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'blog'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre>
</div>

<p>If you navigate to <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> in your browser you should see the following page.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/02_django_welcome.png" alt="Django welcome page" /></p>

<p>Ok, initial installation complete! Next we’ll create our database model for blog posts.</p>

<h2 id="database-models">Database Models</h2>
<p>What are the characteristics of a typical blog application? In our case let’s keep things simple and assume each post has a title, author, and body. We can turn this into a database model by opening the <code class="highlighter-rouge">blog/models.py</code> file and enter the code below:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/models.py</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s">'auth.User'</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</code></pre>
</div>

<p>At the top we’re importing the class <code class="highlighter-rouge">models</code> and then creating a subclass of <code class="highlighter-rouge">models.Model</code> called <code class="highlighter-rouge">Post</code>. Using this subclass functionality we automatically have access to everything within <a href="https://docs.djangoproject.com/en/2.0/topics/db/models/">django.db.models.Models</a> and can add additional fields and methods as desired.</p>

<p>For <code class="highlighter-rouge">title</code> we’re limiting the length to 200 characters and for <code class="highlighter-rouge">body</code> we’re using a TextField which will automatically expand as needed to fit the user’s text. There are many field types available in Django; you can see the <a href="https://docs.djangoproject.com/en/2.0/topics/db/models/#fields">full list here</a>.</p>

<p>For the <code class="highlighter-rouge">author</code> field we’re using a <a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/#django.db.models.ForeignKey">ForeignKey</a> which allows for a <em>many-to-one</em> relationship. This means that a given user can be the author of many different blog posts but not the other way around. The reference is to the built-in <code class="highlighter-rouge">User</code> model that Django provides for authentication. For all many-to-one relationships such as a ForeignKey we must also specify an <a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/#django.db.models.ForeignKey.on_delete">on_delete</a> option. Don’t worry if this is confusing right now. Database design is a very deep field and we’ll do much more with ForeignKey’s in future chapters. For now, if you’re curious check out a <a href="https://wsvincent.com/database-design-tutorial-for-beginners/">database design tutorial for beginners</a>.</p>

<p>Now that our new database model is created we need to create a new migration record for it and migrate the change into our database. This two-step process can be completed with the commands below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ ./manage.py makemigrations blog
(blog) $ ./manage.py migrate blog
</code></pre>
</div>

<p>Our database is configured! What’s next?</p>

<h2 id="admin">Admin</h2>
<p>We need a way to access our data. Enter the Django admin! First create a superuser account by typing the command below and following the prompts to set up an email and password. Note that when typing your password, it will not appear on the screen for security reasons.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ ./manage.py createsuperuser
Username (leave blank to use 'wsv'): wsv
Email:
Password:
Password (again):
Superuser created successfully.
</code></pre>
</div>

<p>Now start running the Django server again with the command <code class="highlighter-rouge">./manage.py runserver</code> and open up the Django admin at <a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a>. Login with your new superuser account.</p>

<p>Oops! Where’s our new <code class="highlighter-rouge">Post</code> model?</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_admin_blank.png" alt="Admin homepage" /></p>

<p>We forgot to update <code class="highlighter-rouge">blog/admin.py</code> so let’s do that now.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/admin.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
</code></pre>
</div>

<p>If you refresh the page you’ll see the update.
<img src="https://djangoforbeginners.com/assets/images/book/05_admin_posts.png" alt="Admin homepage" /></p>

<p>Let’s add two blog posts so we have some sample data to work with. Click on the <code class="highlighter-rouge">+ Add</code> button next to <code class="highlighter-rouge">Posts</code> to create a new entry. Make sure to add an “author” to each post too since by default all model fields are required. If you try to enter a post without an author you will see an error. If we wanted to change this, we could add <a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/#field-options">field options</a> to our model to make a given field optional or fill it with a default value.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_admin_first_post.png" alt="Admin first post" /></p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_admin_second_post.png" alt="Admin second post" /></p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_admin_home_two_posts.png" alt="Admin homepage with two posts" /></p>

<p>Now that ohttps://djangoforbeginners.com/assets/images/book/05_admin_home_two_posts.pngur database model is complete we need to create the necessary views, URLs, and templates so we can display the information on our web application.</p>

<h2 id="urls">URLs</h2>
<p>We want to display our blog posts on the homepage so, as in previous chapters, we’ll first configure our project-level URLConfs and then our app-level URLConfs to achieve this.</p>

<p>On the command line quit the existing server with <code class="highlighter-rouge">Control-c</code> and create a new <code class="highlighter-rouge">urls.py</code> file within our <code class="highlighter-rouge">blog</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ touch blog/urls.py
</code></pre>
</div>

<p>Now update it with the code below.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/urls.py</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BlogListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>We’re importing our soon-to-be-created views at the top. The empty string <code class="highlighter-rouge">''</code> tells Python to match all values and we make it a named URL, <code class="highlighter-rouge">home</code>, which we can refer to in our views later on. While it’s optional to add a <a href="https://docs.djangoproject.com/en/2.0/topics/http/urls/#url-namespaces">named URL</a> it’s a best practice you should adopt as it helps keep things organized as your number of URLs grows.</p>

<p>We also should update our project-level <code class="highlighter-rouge">urls.py</code> file so that it knows to forward all requests directly to the blog app.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog_project/urls.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'blog.urls'</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>We’ve added <code class="highlighter-rouge">include</code> on the second line and a urlpattern using an empty string regular expression <code class="highlighter-rouge">''</code> indicating that URL requests should be redirected as is to <code class="highlighter-rouge">blog</code>’s URLs for further instructions.</p>

<h2 id="views">Views</h2>
<p>We’re going to use class-based views but if want to see a function-based way to build a blog application, I highly recommend the <a href="https://tutorial.djangogirls.org/en/">Django Girls Tutorial</a>.</p>

<p>In our views file, add the code below to display the contents of our <code class="highlighter-rouge">Post</code> model using <code class="highlighter-rouge">ListView</code>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/views.py</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">BlogListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'home.html'</span>
</code></pre>
</div>

<p>On the top two lines we import <a href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#listview">ListView</a> and our database model <code class="highlighter-rouge">Post</code>. Then we subclass <code class="highlighter-rouge">ListView</code> and add links to our model and template. This saves us a lot of code versus implementing it all from scratch.</p>

<h2 id="templates">Templates</h2>
<p>With our URLConfs and Views now complete, we’re only missing the third piece of the puzzle: templates! As we already saw in <a href="/message-board/">Chapter 4: Message board app</a>, we can inherit from other templates to keep our code clean. Thus we’ll start off with a <code class="highlighter-rouge">base.html</code> file and a <code class="highlighter-rouge">home.html</code> file that inherits from it. Then later when we add templates for creating and editing blog posts, they too can inherit from <code class="highlighter-rouge">base.html</code>.</p>

<p>Start by creating our project-level <code class="highlighter-rouge">templates</code> directory with the two template files.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ mkdir templates
(blog) $ touch templates/base.html
(blog) $ touch templates/home.html
</code></pre>
</div>

<p>Then update <code class="highlighter-rouge">settings.py</code> so Django knows to look there for our templates.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog_project/settings.py</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">)],</span>
        <span class="o">...</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre>
</div>

<p>Update the <code class="highlighter-rouge">base.html</code> template as follows.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/base.html --&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Django blog<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header&gt;</span>
      <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Django blog<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      {% block content %}
      {% endblock content %}
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>Note that code between <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">content</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> and
<code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">endblock</span><span class="w"> </span><span class="err">content</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> can be filled by other templates. Speaking of which, here is the code for <code class="highlighter-rouge">home.html</code>.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/home.html --&gt;</span>
{% extends 'base.html' %}

{% block content %}
  {% for post in object_list %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-entry"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;&lt;a</span> <span class="na">href=</span><span class="s">""</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h2&gt;</span>
      <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  {% endfor %}
{% endblock content %}
</code></pre>
</div>

<p>At the top we note that this template extends <code class="highlighter-rouge">base.html</code> and then wrap our desired code with <code class="highlighter-rouge">content</code> blocks. Then we use the Django Templating Language to set up a simple <em>for loop</em> for each blog post. Note that <code class="highlighter-rouge">object_list</code> comes from <code class="highlighter-rouge">ListView</code> and contains all the objects in our view.</p>

<p>If you start the Django server again <code class="highlighter-rouge">./manage.py runserver</code> and refresh <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> we can see it’s working.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_homepage_no_styling.png" alt="Blog homepage with two posts" /></p>

<p>But it looks terrible. Let’s fix that!</p>

<h2 id="static-files">Static files</h2>
<p>We need to add some CSS which is referred to as a static file because, unlike our dynamic database content, it doesn’t change. Fortunately it’s straightforward to add static files like CSS, JavaScript, and images to our Django project.</p>

<p>In a production-ready Django project you would typically store this on a Content Delivery Network (CDN) for better performance, but for our purposes storing the files locally is fine.</p>

<p>First quit our local server with <code class="highlighter-rouge">Control-c</code>. Then create a project-level folder called <code class="highlighter-rouge">static</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ mkdir static
</code></pre>
</div>

<p>Just as we did with our <code class="highlighter-rouge">templates</code> folder we need to update <code class="highlighter-rouge">settings.py</code> to tell Django where to look for these static files. We can update <code class="highlighter-rouge">settings.py</code> with a one-line change for <code class="highlighter-rouge">STATICFILES_DIRS</code>. Add it at the bottom of the file below the entry for <code class="highlighter-rouge">STATIC_URL</code>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog_project/settings.py</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'static'</span><span class="p">)]</span>
</code></pre>
</div>

<p>Now create a <code class="highlighter-rouge">css</code> folder within <code class="highlighter-rouge">static</code> and add a new <code class="highlighter-rouge">base.css</code> file in it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ mkdir static/css
(blog) $ touch static/css/base.css
</code></pre>
</div>

<p>What should we put in our file? How about changing the title to be red?</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="c">/* static/css/base.css */</span>
<span class="nt">header</span> <span class="nt">h1</span> <span class="nt">a</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Last step now. We need to add the static files to our templates by adding <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">load</span><span class="w"> </span><span class="err">staticfiles</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> to the top of <code class="highlighter-rouge">base.html</code>. Because our other templates inherit from <code class="highlighter-rouge">base.html</code> we only have to add this once. And include a new line at the bottom of the <code class="highlighter-rouge">&lt;head&gt;&lt;/head&gt;</code> code that explicitly references our new <code class="highlighter-rouge">base.css</code> file.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/base.html --&gt;</span>
{% load staticfiles %}
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Django blog<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{% static 'css/base.css' %}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  ...
</code></pre>
</div>

<p>Phew! That was a bit of a pain but it’s a one-time pain. Now we can add static files to our <code class="highlighter-rouge">static</code> folder and they’ll automatically appear in all our templates!</p>

<p>Start up the server again with <code class="highlighter-rouge">.manage.py runserver</code> and look at our updated homepage at <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_homepage_red_h1.png" alt="Blog homepage with red title" /></p>

<p>We can do a little better though. How about if we add a custom font and some more CSS? Since this is not a tutorial on CSS simply add the following between  <code class="highlighter-rouge">&lt;head&gt;&lt;/head&gt;</code> tags to add <a href="https://fonts.google.com/specimen/Source+Sans+Pro">Source Sans Pro</a>, a free font from Google.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/base.html --&gt;</span>
{% load staticfiles %}
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Django blog<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family=Source+Sans+Pro:400"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{% static 'css/base.css' %}"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
  ...
</code></pre>
</div>

<p>Then update our css file by copy and pasting the following code:</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="c">/* static/css/base.css */</span>
<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Source Sans Pro'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">18px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="p">{</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#999</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">header</span> <span class="nt">h1</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
  <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.nav-left</span> <span class="p">{</span>
  <span class="nl">margin-right</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.nav-right</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">padding-top</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.post-entry</span> <span class="p">{</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.post-entry</span> <span class="nt">h2</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">.5rem</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.post-entry</span> <span class="nt">h2</span> <span class="nt">a</span><span class="o">,</span> <span class="nc">.post-entry</span> <span class="nt">h2</span> <span class="nt">a</span><span class="nd">:visited</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">blue</span><span class="p">;</span>
  <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.post-entry</span> <span class="nt">p</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="m">400</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.post-entry</span> <span class="nt">h2</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Refresh the homepage at <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> and you should see the following.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_homepage_css.png" alt="Blog homepage with CSS" /></p>

<h2 id="individual-blog-pages">Individual blog pages</h2>
<p>Now we can add the functionality for individual blog pages. How do we do that? We need to create a new view, url, and template. I hope you’re noticing a pattern in development with Django now!</p>

<p>Start with the view. We can use the generic view <a href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView">DetailView</a> to simplify things. At the top of the file add <code class="highlighter-rouge">DetailView</code> to the list of imports and then create our new view called <code class="highlighter-rouge">BlogDetailView</code>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/views.py</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">BlogListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'home.html'</span>


<span class="k">class</span> <span class="nc">BlogDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'post_detail.html'</span>
</code></pre>
</div>

<p>In this new view we define the model we’re using, <code class="highlighter-rouge">Post</code>, and the template we want it associated with, <code class="highlighter-rouge">post_detail.html</code>. By default <code class="highlighter-rouge">DetailView</code> will provide a context object we can use in our template called either <code class="highlighter-rouge">object</code> or the name of our model, so <code class="highlighter-rouge">post</code>. Also, <code class="highlighter-rouge">DetailView</code> expects either a primary key or a slug passed to it as the identifier. More on this shortly.</p>

<p>Now exit the local server <code class="highlighter-rouge">Control-c</code> and create our new template for a post detail as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(blog) $ touch templates/post_detail.html
</code></pre>
</div>

<p>And then type in the following code:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/post_detail.html --&gt;</span>
{% extends 'base.html' %}

{% block content %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-entry"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{ post.title }}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

{% endblock content %}
</code></pre>
</div>

<p>At the top we specify that this template inherits from <code class="highlighter-rouge">base.html</code>. And then display the <code class="highlighter-rouge">title</code> and <code class="highlighter-rouge">body</code> from our context object, which <code class="highlighter-rouge">DetailView</code> makes accessible as <code class="highlighter-rouge">post</code>.</p>

<p>Personally I found the naming of context objects in generic views extremely confusing at first. Because our context object from DetailView is either our model name <code class="highlighter-rouge">post</code> or <code class="highlighter-rouge">object</code> we could also update our template as follows and it would work exactly the same.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/post_detail.html --&gt;</span>
{% extends 'base.html' %}

{% block content %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-entry"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{ object.title }}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ object.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

{% endblock content %}
</code></pre>
</div>

<p>And if you find using <code class="highlighter-rouge">post</code> or <code class="highlighter-rouge">object</code> confusing, we can also explicitly set the name of the context object in our view. So if we wanted to call it <code class="highlighter-rouge">anything_you_want</code> and then use that in the template, the code would look as follows and it would work the same.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/views.py</span>
<span class="o">...</span>
<span class="k">class</span> <span class="nc">BlogDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'post_detail.html'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'anything_you_want'</span>
</code></pre>
</div>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/post_detail.html --&gt;</span>
{% extends 'base.html' %}

{% block content %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-entry"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{ anything_you_want.title }}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ anything_you_want.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

{% endblock content %}
</code></pre>
</div>

<p>The “magic” naming of the context object is a price you pay for the ease and simplicity of using generic views. They’re great if you know what they’re doing but can be hard to customize if you want different behavior.</p>

<p>Ok, what’s next? How about adding a new URLConf for our view, which we can do as follows.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/urls.py</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BlogListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'post/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BlogDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'post_detail'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>All blog post entries will start with <code class="highlighter-rouge">post/</code>. Next is the primary key for our post entry which will be represented as an integer <code class="highlighter-rouge">&lt;int:pk&gt;</code>. What’s the primary key you’re probably asking? Django automatically adds an <a href="https://docs.djangoproject.com/en/2.0/topics/db/models/#automatic-primary-key-fields">auto-incrementing primary key</a> to our database models. So while we only declared the fields <code class="highlighter-rouge">title</code>, <code class="highlighter-rouge">author</code>, and <code class="highlighter-rouge">body</code> on our <code class="highlighter-rouge">Post</code> model, under-the-hood Django also added another field called <code class="highlighter-rouge">id</code>, which is our primary key. We can access it as either <code class="highlighter-rouge">id</code> or <code class="highlighter-rouge">pk</code>.</p>

<p>The <code class="highlighter-rouge">pk</code> for our first “Hello, World” post is 1. For the second post, it is 2. And so on. Therefore when we go to the individual entry page for our first post, we can expect that its urlpattern will be <code class="highlighter-rouge">post/1</code>.</p>

<p><strong>Note</strong>: Understanding how primary keys work with DetailView is a <strong>very common</strong> place of confusion for beginners. It’s worth re-reading the previous two paragraphs a few times if it doesn’t click. With practice it will become second nature.</p>

<p>If you now start up the server with <code class="highlighter-rouge">./manage.py runserver</code> and go directly to <a href="http://127.0.0.1:8000/post/1/">http://127.0.0.1:8000/post/1/</a> you’ll see a dedicated page for our first blog post.</p>

<p><img src="https://djangoforbeginners.com/assets/images/book/05_blog_detail_one.png" alt="Blog post one detail" /></p>

<p>Woohoo! You can also go to <a href="http://127.0.0.1:8000/post/2/">http://127.0.0.1:8000/post/2/</a> to see the second entry.</p>

<p>To make our life easier, we should update the link on the homepage so we can directly access individual blog posts from there. Currently in <code class="highlighter-rouge">home.html</code> our link is empty: <code class="highlighter-rouge">&lt;a href=""&gt;</code>. Update it to <code class="highlighter-rouge">&lt;a href="{% url 'post_detail' post.pk %}"&gt;</code>.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- templates/home.html --&gt;</span>
{% extends 'base.html' %}

{% block content %}
  {% for post in object_list %}
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-entry"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'post_detail' post.pk %}"</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ post.body }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  {% endfor %}
{% endblock content %}
</code></pre>
</div>

<p>We start off by telling our Django template we want to reference a URLConf by using the code <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">url</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>. Which URL? The one named <code class="highlighter-rouge">post_detail</code>, which is the name we gave <code class="highlighter-rouge">BlogDetailView</code> in our URLConf just a moment ago. If we look at <code class="highlighter-rouge">post_detail</code> in our URLConf, we see that it expects to be passed an argument <code class="highlighter-rouge">pk</code> representing the primary key for the blog post. Fortunately, Django has already created and included this <code class="highlighter-rouge">pk</code> field on our <code class="highlighter-rouge">post</code> object. We pass it into the URLConf by adding it in the template as <code class="highlighter-rouge">post.pk</code>.</p>

<p>To confirm everything works, refresh the main page at <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> and click on the title of each blog post to confirm the new links work.</p>

<h2 id="tests">Tests</h2>
<p>There are several new things to test in this app that we haven’t seen before. We want to test that the <code class="highlighter-rouge">Post</code> model works as expected, including its <code class="highlighter-rouge">str</code> representation. We want to test <code class="highlighter-rouge">ListView</code> and also <code class="highlighter-rouge">DetailView</code>. And we’re interacting with the <code class="highlighter-rouge">User</code> for the first time.</p>

<p>Here’s what sample tests look like in the <code class="highlighter-rouge">blog/tests.py</code> file.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># blog/tests.py</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">BlogTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">"wsv"</span><span class="p">)</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s">"my title"</span><span class="p">,</span>
            <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="s">"just a test"</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_string_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"My entry title"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="p">),</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_post_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="s">'{post.title}'</span><span class="p">,</span> <span class="s">"my title"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="s">'{post.author}'</span><span class="p">,</span> <span class="s">"wsv"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="s">'{post.body}'</span><span class="p">,</span> <span class="s">"just a test"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_post_list_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'just a test'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'home.html'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_post_detail_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/post/1/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'my title'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'post_detail.html'</span><span class="p">)</span>
</code></pre>
</div>

<p>Go ahead and run these tests. They should all pass.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(testy) $ ./manage.py test
</code></pre>
</div>

<h2 id="git">Git</h2>
<p>Now is also a good time for our first <em>git</em> commit. First initialize our directory.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(testy) $ git init
</code></pre>
</div>

<p>Then review all the content we’ve added by checking the <code class="highlighter-rouge">status</code>. Add all new files. And make our first <code class="highlighter-rouge">commit</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(testy) $ git status
(testy) $ git add -A
(testy) $ git commit -m 'initial commit'
</code></pre>
</div>

<h2 id="conclusion">Conclusion</h2>
<p>We’ve now built a basic blog application from scratch! Using the Django admin we can create, edit, or delete the content.</p>

<p>In the next section,
<a href="chapter_06.html">Chapter 6: Blog app with forms</a>, we’ll add forms so we don’t have to use the Django admin at all for these changes.</p>

<p><br /></p>
<hr />

<p><br />

  </div>
</article>

    </div>
  </main>
    <footer>
  <div class="container-flex">
    <div class="nav-wrapper">
      <div class="footer-left">
        Copyright &copy; 2018
      </div>
      <div class="footer-right">
        <a href="/">Home</a>
        <a href="/about/">About</a>
        <a href="http://eepurl.com/cRL-aP" target="_blank">Newsletter</a>
      </div>
    </div>
  </div>
</footer>

    <!-- Google Analytics -->

</body>
</html>
